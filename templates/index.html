<body>
    <h3>Welcome to deepseek running on the old pc!</h3>
    <img src="../static/r.png" style="width: 166px; height: 214px"><br>
    <form id="queryForm" method="POST" action="/query-ai">
        <label for="modelDropdown">Select a model:</label>
        <select id="modelDropdown" name="model">
        </select>
        <br>
        <label for="inputText">Enter your query:</label>
        <input id="inputText" name="query" type="text" required>
        <br>
        <button type="submit">Submit</button>
    </form>
    <h3>Conversation History:</h3>
    <div id="conversationHistory" style="border: 1px solid #ccc; padding: 10px; margin-top: 10px;">
        <!-- Messages will be appended here -->
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Fetch models and populate the dropdown
            fetch('/get-models')
                .then(response => response.json())
                .then(data => {
                    const dropdown = document.getElementById('modelDropdown');
                    data.models.forEach(model => {
                        const option = document.createElement('option');
                        option.value = model;
                        option.textContent = model;
                        dropdown.appendChild(option);
                    });
                })
                .catch(error => console.error('Error fetching models:', error));
        });
        document.getElementById('queryForm').addEventListener('submit', async function (event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            const response = await fetch('/query-ai', {
                method: 'POST',
                body: formData
            });
            const data = await response.json();

            // Append the new message to the conversation history
            const historyDiv = document.getElementById('conversationHistory');
            const userMessage = document.createElement('div');
            userMessage.textContent = `User: ${formData.get('query')}`;
            historyDiv.appendChild(userMessage);

            const aiMessage = document.createElement('div');
            aiMessage.textContent = `AI: ${data.response}`;
            historyDiv.appendChild(aiMessage);
        });
    </script>
</body>